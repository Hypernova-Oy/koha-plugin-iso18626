---
info:
  title: Koha::Plugin::ISO18626 OpenAPI spec
  version: 22.11.0
paths:
  /borrowers/ssstatus:
    get:
      description: This endpoint is intended to be used by barcode readers to quickly
        check for self-service permissions and availability. The self-service device
        is expected to authenticate using it's own credentials and it√§s own default
        library location. <p>See the description of response with status '200 OK'
        for expected access restrictions.</p>
      operationId: getSelfServiceStatus
      parameters:
      - description: The barcode of the library card the Borrower uses to authenticate
        in: formData
        name: cardnumber
        required: true
        type: string
      - description: The branchcode of the library to check for permissions
        in: formData
        name: branchcode
        required: false
        type: string
      produces:
      - application/json
      responses:
        '200':
          description: Permission granted/denied
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceStatus
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No such barcode in use
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Unexpected exception happened?!??.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '501':
          description: Feature not configured properly. Notify the API maintainer.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Check if a borrower is allowed to access self-service resources
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        permissions:
          borrowers: get_self_service_status
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#get_self_service_status
  /borrowers/{borrowernumber}/ssblocks:
    delete:
      description: ''
      operationId: borrower_ss_blocks_delete
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      produces:
      - application/json
      responses:
        '200':
          description: Deleted ok
          schema:
            properties:
              deleted_count:
                description: How many Block-objects have been deleted in the DB
                type: integer
            required:
            - deleted_count
            type: object
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No self-service blocks for the given Patron
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Deletes the Borrower's branch-specific self-service blocks for all
        branches
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        permissions:
          borrowers: ss_blocks_delete
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_blocks_delete
    get:
      description: Can access logged in user's own data, or his guarantees/guarantors.
        By default, returns the currently active blocks.
      operationId: borrower_ss_blocks_list
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      produces:
      - application/json
      responses:
        '200':
          description: List of self-service blocks
          schema:
            items:
              $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceBlock
            type: array
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No self-service blocks for the given Patron
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Returns the Borrower's branch-specific self-service blocks
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        allow-guarantor: true
        allow-owner: true
        permissions:
          borrowers: ss_blocks_list
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_blocks_list
    post:
      description: ''
      operationId: borrower_ss_blocks_post
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowerSelfServiceBlockBodyParam
      produces:
      - application/json
      responses:
        '200':
          description: The created self-service block
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceBlock
        '400':
          description: Related borrower, creator or branchcode is missing
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No related object found
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Creates a branch-specific self-service block for the given borrower
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        permissions:
          borrowers: ss_blocks_create
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_blocks_post
  /borrowers/{borrowernumber}/ssblocks/hasblock/{branchcode}:
    get:
      description: Can access logged in user's own data, or his guarantees/guarantors
      operationId: borrower_ss_block_has
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/branchcodePathParam
      produces:
      - application/json
      responses:
        '200':
          description: A self-service block
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceBlock
        '204':
          description: No such self-service block
        '401':
          description: Unauthenticated
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Checks if the given borrower has a block to the given branch
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        allow-guarantor: true
        allow-owner: true
        permissions:
          borrowers: ss_blocks_get
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_block_has
  /borrowers/{borrowernumber}/ssblocks/{borrower_ss_block_id}:
    delete:
      description: ''
      operationId: borrower_ss_block_delete
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrower_ss_block_idPathParam
      produces:
      - application/json
      responses:
        '200':
          description: Deleted ok
          schema:
            properties:
              deleted_count:
                description: How many Block-objects have been deleted in the DB
                type: integer
            required:
            - deleted_count
            type: object
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No related object found
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Deletes the Borrower's branch-specific self-service blocks for all
        branches
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        permissions:
          borrowers: ss_blocks_delete
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_block_delete
    get:
      description: Can access logged in user's own data, or his guarantees/guarantors
      operationId: borrower_ss_block_get
      parameters:
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrowernumberPathParam
      - $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/parameters.yaml#/borrower_ss_block_idPathParam
      produces:
      - application/json
      responses:
        '200':
          description: A self-service block
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceBlock
        '401':
          description: Unauthorized
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '403':
          description: No permission
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No such self-service block
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Internal Server Error
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Returns the Borrower's single branch-specific self-service block
      tags:
      - patrons
      - self_service
      x-koha-authorization:
        allow-guarantor: true
        allow-owner: true
        permissions:
          borrowers: ss_blocks_get
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#ss_block_get
  /iso18626:
    post:
      operationId: iso18626
      produces:
      - application/xml
      responses:
        '200':
          description: Responds with the ISO18626 XML payload
      summary: Omnibus to receive all the ISO18626 Messages defined in the standard
      tags:
      - ill
      x-mojo-to: ISO18626::RESTController#iso18626
  /selfservice/openinghours:
    get:
      operationId: listOpeningHours
      produces:
      - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/selfServiceAllOpeningHours
        '500':
          description: Unexpected exception happened?!??.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '501':
          description: Feature not configured properly. Notify the API maintainer.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Check the opening hours of our self-service resources
      tags:
      - self_service
      - openinghours
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#list_openingHours
  /selfservice/openinghours/self:
    get:
      operationId: getOpeningHours
      produces:
      - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/selfServiceOpeningHours
        '401':
          description: User is not authenticated.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '404':
          description: No opening hours defined for the logged in user's branch.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '500':
          description: Unexpected exception happened?!??.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
        '501':
          description: Feature not configured properly. Notify the API maintainer.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Check the opening hours of the logged in self-service resources API
        user. Uses the user accounts homebranch-field to get the opening hours for.
      tags:
      - self_service
      - openinghours
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#get_openingHours
  /selfservice/pincheck:
    get:
      consumes:
      - application/json
      operationId: getPINCheck
      parameters:
      - description: The Username the Borrower uses to authenticate
        in: body
        name: body
        required: true
        schema:
          properties:
            cardnumber:
              description: User's cardnumber or username
              type:
              - string
            password:
              description: The user's password'
              format: password
              type: string
          required:
          - cardnumber
          - password
          type: object
      produces:
      - application/json
      responses:
        '200':
          description: ''
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/borrowerSelfServiceStatus
        '404':
          description: No such user cardnumber or username found.
          schema:
            $ref: file:///root/Koha/dev-plugins/koha-plugin-iso18626/Koha/Plugin/ISO18626/openapi/definitions.yaml#/error
      summary: Check the self-service PIN and cardnumber.
      tags:
      - self_service
      - auth
      x-koha-authorization:
        permissions:
          borrowers: get_self_service_status
      x-mojo-to: Fi::KohaSuomi::SelfService::StatusApi#get_PINCheck
swagger: '2.0'
